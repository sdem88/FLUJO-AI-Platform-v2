#!/bin/bash

echo "üöÄ –ó–∞–ø—É—Å–∫ FLUJO - –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è AI –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è"
echo "============================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Node.js
if ! command -v node &> /dev/null; then
    echo "‚ùå Node.js –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node.js –≤–µ—Ä—Å–∏–∏ 18 –∏–ª–∏ –≤—ã—à–µ"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é Node.js
NODE_VERSION=$(node -v | cut -d'v' -f2 | cut -d'.' -f1)
if [ "$NODE_VERSION" -lt 18 ]; then
    echo "‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è Node.js –≤–µ—Ä—Å–∏–∏ 18 –∏–ª–∏ –≤—ã—à–µ. –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: $(node -v)"
    exit 1
fi

echo "‚úÖ Node.js $(node -v) –æ–±–Ω–∞—Ä—É–∂–µ–Ω"

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é FLUJO
cd "$(dirname "$0")"
echo "üìÅ –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: $(pwd)"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
if [ ! -d "node_modules" ]; then
    echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
    npm install
    if [ $? -ne 0 ]; then
        echo "‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"
        exit 1
    fi
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ .env —Ñ–∞–π–ª–∞
if [ ! -f ".env" ]; then
    echo "‚ö†Ô∏è  –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ –∏ –¥–æ–±–∞–≤—å—Ç–µ API –∫–ª—é—á–∏"
    echo "–ü—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ:"
    echo "OPENAI_API_KEY=your_openai_api_key_here"
    echo "ANTHROPIC_API_KEY=your_anthropic_api_key_here"
    echo "GOOGLE_API_KEY=your_google_api_key_here"
fi

# –°–æ–±–∏—Ä–∞–µ–º MCP —Å–µ—Ä–≤–µ—Ä—ã
echo "üîß –°–±–æ—Ä–∫–∞ MCP —Å–µ—Ä–≤–µ—Ä–æ–≤..."
cd mcp-servers/servers
npm run build 2>/dev/null || echo "‚ö†Ô∏è  –ù–µ–∫–æ—Ç–æ—Ä—ã–µ MCP —Å–µ—Ä–≤–µ—Ä—ã –Ω–µ –±—ã–ª–∏ —Å–æ–±—Ä–∞–Ω—ã"
cd ../..

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
echo "üöÄ –ó–∞–ø—É—Å–∫ FLUJO –Ω–∞ –ø–æ—Ä—Ç—É 4200..."
echo "üåê –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:4200 –≤ –±—Ä–∞—É–∑–µ—Ä–µ"
echo ""
echo "–ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
echo "- npm run dev      - –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å hot reload"
echo "- npm run build    - –°–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞"
echo "- npm run start    - –ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å–µ—Ä–≤–µ—Ä–∞"
echo ""

# –ó–∞–ø—É—Å–∫–∞–µ–º –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run dev